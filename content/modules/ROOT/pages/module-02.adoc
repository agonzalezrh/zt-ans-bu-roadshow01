# 📊 Ansible System Data & Compliance Lab Guide

---

## 🎯 Infrastructure Data Gathering with Ansible

**Welcome to Infrastructure Intelligence!**

Sometimes you just need data about your systems, and you can get this data with Ansible! Ansible can automate almost everything but one of the best tasks to start on is the gathering of infrastructure data. You know you have servers, networks etc but trying to audit or gather all the system data can be a big exercise. Luckily, you can use Ansible at scale for this.

> 💡 **TIP:** Infrastructure data gathering is one of the safest ways to start your automation journey - it's read-only and provides immediate value!

---

## 🔐 Lab Environment Credentials

### **Ansible Automation Platform Access**

| Username | Password |
|----------|----------|
| **admin** | **ansible123!** |


## ☑️ Exercise 1: Tell me about my servers

### 🎯 **Objective**
Learn how to gather detailed system information using Ansible's setup module and ad-hoc commands.

### **Step 1: Access Inventory Management**

1. Navigate to your lab **`aap`** tab and login

2. Navigate to **Automation Execution** → **Infrastructure** → **Inventories**
   > 📝 **NOTE:** This is where we keep track of the systems we automate - you will see a few inventories already built for you

3. Select the **Video Platform Inventory**

4. Select the **Hosts** tab

.Node01
image::node01-setup.png[]

### **Step 2: Execute Ad-hoc System Facts Collection**

We are going to use the Ansible Automation Platform's ability to run ad-hoc commands to gather system facts or system data.

1. Select the host: **`node01`**

2. Click on **Run command**

3. You now have prompts for what command you want to run against this host

4. Select the **Setup** module from the module dropdown list

5. Click **Next**

.Setup
iamge::setup.png[]

### **Step 3: Configure Execution Environment**

1. We need to pick an execution environment to run this module
   > 📝 **NOTE:** In the Ansible Automation Platform, we use Execution Environments to launch templates/playbooks

2. Select the **Default execution environment**

3. Click **Next**

### **Step 4: Set Credentials and Execute**

1. Choose the credentials for the target host interaction

2. Select the **Application Nodes** credential

3. Click **Next**

4. Click **Finish**

### **Step 5: Review System Facts**

Once the command executes, you will be presented with comprehensive system facts.

.Output
image::setup-output.png[]

> ✨ **Amazing!** This is all the information that Ansible can gather from the system automatically!

---

## ☑️ Exercise 2: More info, more scale?

### 🎯 **Objective**
Generate dynamic infrastructure reports using Ansible templates and system facts at scale.

**We need infrastructure awareness!** And with Ansible it's super easy. We can use Ansible and Jinja templates to create dynamic reports based on facts and Ansible tasks. Let's dive in!

### **Step 1: Generate Application Server Report**

1. Navigate to **Automation Execution** → **Templates**

2. Execute **Application Server Report**

3. This template will prompt you with a few options - click **All**

### **Step 2: View Generated Report**

1. Once completed, navigate to the **Report Server** tab

2. Refresh the page to see the report

.Report
image::srv-report.png[]

> 🎉 **Excellent!** Notice we also have the backups reported in this report too!

.Backup
images::backup-data.png[]

### **Step 3: Customize Report Options**

> 💡 **TIP:** You can re-run the report template and choose other options if you want to create other reports for specific criteria.

---

## ☑️ Exercise 3: Is our server compliant?

### 🎯 **Objective**
Execute OpenSCAP compliance scanning and generate security compliance reports for infrastructure audit purposes.

**We love reports!** But do you know who else loves reports? **InfoSec!!** We can run an OpenSCAP compliance report as we have that template available to us! Security has asked for the compliance report for **Node02** so let's have a look!

### **Step 1: Execute OpenSCAP Compliance Scan**

1. Navigate to **Automation Execution** → **Templates**

2. Execute **OpenSCAP Report**

3. Wait for the job to complete

### **Step 2: Access Compliance Results**

1. Once the job is completed, navigate to the **Compliance Report** tab

.Compliance
image::compliance_report_folder.png[]

### **Step 3: Review Detailed Compliance Data**

1. Click on the report to view the detailed results

.ComReport
image::compliance_report.png[]

> 🔒 **Security Achievement Unlocked!** You now have comprehensive compliance visibility across your infrastructure!

---

## 💻 Code Snippets for Review

### 🔍 **OpenSCAP Automation Code**

Here's the key Ansible code for automating OpenSCAP compliance scanning:

```yaml
tasks:

- name: Check if the system is RHEL 8
  ansible.builtin.debug:
    msg: "This playbook is not compatible with {{ inventory_hostname }} (not RHEL 8)"
  when: ansible_distribution != "RedHat" or ansible_distribution_major_version != "8"
  failed_when: false

- name: Run compliance tasks on RHEL 8 systems only
  when: ansible_distribution == "RedHat" and ansible_distribution_major_version == "8"
  block:
    - name: Get our facts straight
      ansible.builtin.set_fact:
        _profile: '{{ compliance_profile | replace("pci_dss", "pci-dss") }}'
        _report_dir: /tmp/oscap-reports

    - name: Ensure OpenSCAP tools are installed
      ansible.builtin.dnf:
        name: '{{ openscap_packages }}'
        state: present

    - name: Configure httpd
      when: use_httpd | bool
      block:
        - name: Install httpd
          ansible.builtin.dnf:
            name: httpd
            state: present
          notify: Restart httpd

        - name: Override report directory
          ansible.builtin.set_fact:
            _report_dir: /var/www/html/oscap-reports

        - name: Gather service facts
          ansible.builtin.service_facts:

        - name: Enable firewall http service
          ansible.posix.firewalld:
            service: http
            state: enabled
            immediate: true
            permanent: true
          when: "'firewalld.service' in ansible_facts.services"

        - name: Disable httpd welcome page
          ansible.builtin.file:
            path: /etc/httpd/conf.d/welcome.conf
            state: absent
          notify: Restart httpd

    - name: Create report on Report Server
      block:
        - name: Ensure report directory exists
          ansible.builtin.file:
            path: '{{ _report_dir }}/{{ _profile }}'
            state: directory
            owner: root
            group: root
            mode: 0755

        - name: Set report name
          ansible.builtin.set_fact:
            _report: '{{ _report_dir }}/{{ _profile }}/report-{{ inventory_hostname }}-{{ ansible_date_time.iso8601 }}.html'

        - name: Generate compliance report
          ansible.builtin.command: >-
            oscap xccdf eval --profile {{ _profile }} --report {{ _report }}
            /usr/share/xml/scap/ssg/content/ssg-rhel{{ ansible_distribution_major_version }}-ds.xml
          args:
            creates: '{{ _report }}'
          register: _oscap
          failed_when: _oscap.rc not in [0, 2]

        - name: Set report permissions
          ansible.builtin.file:
            path: '{{ _report }}'
            owner: root
            group: root
            mode: 0644
```

> 📝 **NOTE:** This comprehensive code demonstrates advanced Ansible techniques including conditional logic, block structures, and security compliance automation.

---

## 🎉 Lab Summary & Completion Checklist

### ✅ **What You've Accomplished**

- ✅ **System Facts Collection:** Mastered ad-hoc command execution for gathering detailed system information
- ✅ **Inventory Management:** Learned to navigate and manage Ansible inventories effectively
- ✅ **Dynamic Reporting:** Created comprehensive infrastructure reports using Jinja templates
- ✅ **Compliance Scanning:** Implemented OpenSCAP security compliance reporting
- ✅ **Execution Environments:** Understood how to leverage execution environments for different tasks
- ✅ **Credential Management:** Applied proper credential selection for secure automation

### 🚀 **Key Learning Outcomes**

1. **Infrastructure Intelligence:** Gained ability to automatically collect and analyze system data at scale
2. **Ad-hoc Operations:** Learned to execute immediate commands across multiple systems simultaneously  
3. **Report Generation:** Developed skills in creating dynamic, data-driven infrastructure reports
4. **Security Compliance:** Implemented automated security scanning and compliance reporting
5. **Scalable Automation:** Experienced how Ansible handles multiple systems effortlessly

### 📊 **Business Value Delivered**

> 💡 **Impact:** You can now provide instant infrastructure visibility, security compliance reporting, and system auditing capabilities that would traditionally take days or weeks to compile manually!

### 📋 **Next Steps**

1. **Expand Reporting:** Try different report criteria and custom filtering options
2. **Scheduled Compliance:** Consider implementing automated compliance scanning schedules
3. **Integration Opportunities:** Explore how to integrate these reports with your existing monitoring tools
4. **Advanced Automation:** Use this foundation to build more complex infrastructure management workflows

---

**🎯 Congratulations on completing the Ansible System Data & Compliance Lab!**

You now have the skills to transform infrastructure management from reactive to proactive, providing comprehensive visibility and compliance oversight across your entire environment!
